<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalhes - TopStyle</title>
  <link rel="stylesheet" href="assets/css/mediaquery-header.css">
  <link rel="stylesheet" href="assets/css/style-header.css">
  <link rel="stylesheet" href="assets/css/base.css">
  <link rel="stylesheet" href="assets/css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/3.5.0/remixicon.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.ibb.co/jPt43z3L/logo-background.png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>

<body>
  <div title="Pegue seu desconto agora!! üòä" class="carrossel-desconto">
    <div class="carrossel-wrapper">
      <span>FRETE GR√ÅTIS ACIMA DE R$100</span>
      <span>COMPRE COM R$10 OFF COM O CUPOM 'TOPSTYLE'</span>
      <span>FRETE GR√ÅTIS ACIMA DE R$100</span>
      <span>COMPRE COM R$10 OFF COM O CUPOM 'TOPSTYLE'</span>
    </div>
    <div class="carrossel-wrapper">
      <span>FRETE GR√ÅTIS ACIMA DE R$100</span>
      <span>COMPRE COM R$10 COM O CUPOM 'TOPSTYLE'</span>
      <span>FRETE GR√ÅTIS ACIMA DE R$100</span>
      <span>COMPRE COM R$10 OFF COM O CUPOM 'TOPSTYLE'</span>
    </div>
  </div>

      <header class="header " id="header">
        <nav class="nav__container">

            <div class="nav__menu header-divs" id="nav-menu">
                <ul class="nav__list">
                    <li title="Categorias" class="nav__item dropdown item1" id="nav__item">
                        <div class="header__link">
                            <a href="#categorias" class="nav__link">Categorias</a>
                            <i class="bi bi-caret-down-fill mobile-caret"></i>
                        </div>

                        <!-- MEGA MENU INSERIDO AQUI -->
                        <div class="mega-menu">
                            <div class="mega-content">
                                <div class="column">
                                    <h3><span class="column__title">Vestu√°rio</span></h3>
                                    <a href="#" data-link-id="vestuario-ver-todos">Ver Todos</a>
                                    <a href="#" data-link-id="vestuario-camisetas">Camisetas</a>
                                    <a href="#" data-link-id="vestuario-plus-size">Camiseta Plus-Size</a>
                                    <a href="#" data-link-id="vestuario-manga-longa">Camiseta Manga Longa</a>
                                    <a href="#" data-link-id="vestuario-moletons">Moletons</a>
                                    <a href="#" data-link-id="vestuario-jaquetas">Jaquetas E Casacos</a>
                                    <a href="#" data-link-id="vestuario-camisas">Camisas</a>
                                    <a href="#" data-link-id="vestuario-calcas">Cal√ßas</a>
                                    <a href="#" data-link-id="vestuario-shorts">Shorts E Bermudas</a>
                                </div>

                                <div class="column">
                                    <h3><span class="column__title">Outros</span></h3>
                                    <a href="#" data-link-id="outros-ver-todos">Ver Todos</a>
                                    <a href="#" data-link-id="outros-juvenil">Juvenil</a>
                                    <a href="#" data-link-id="outros-feminino">Feminino</a>
                                    <a href="#" data-link-id="outros-packs">Packs</a>
                                </div>

                                <div class="column">
                                    <h3><span class="column__title">Acess√≥rios</span></h3>
                                    <a href="#" data-link-id="acessorios-ver-todos">Ver Todos</a>
                                    <a href="#" data-link-id="acessorios-chaveiros">Chaveiros E Adesivos</a>
                                    <a href="#" data-link-id="acessorios-cuecas">Cuecas</a>
                                    <a href="#" data-link-id="acessorios-gorros">Gorros</a>
                                    <a href="#" data-link-id="acessorios-pochetes">Pochetes</a>
                                    <a href="#" data-link-id="acessorios-mochilas">Mochilas</a>
                                    <a href="#" data-link-id="acessorios-meias">Meias</a>
                                    <a href="#" data-link-id="acessorios-bags">Bags</a>
                                    <a href="#" data-link-id="acessorios-bones">Bon√©s</a>
                                    <a href="#" data-link-id="acessorios-bucket">Bucket</a>
                                    <a href="#" data-link-id="acessorios-carteiras">Carteiras</a>
                                </div>

                                <div class="column">
                                    <h3><span class="column__title">Cal√ßados</span></h3>
                                    <a href="#" data-link-id="calcados-ver-todos">Ver Todos</a>
                                    <a href="#" data-link-id="calcados-chinelos">Chinelos</a>
                                    <a href="#" data-link-id="calcados-tenis">T√™nis</a>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li title="Drops" class="nav__item dropdown item1">
                        <div class="header__link">
                            <a href="#drops" class="nav__link">Drops</a>
                            <i class="bi bi-caret-down-fill mobile-caret"></i>
                        </div>

                        <!-- MEGA MENU INSERIDO AQUI -->
                        <div class="mega-menu" id="mega-menu-drops">
                            <div class="mega-content" id="mega-content-drops">
                                <div class="mega-imgs">
                                    <div class="drop-column">
                                        <a href="#" class="drop__img"><img
                                                src="https://www.blog.userefuse.com.br/wp-content/uploads/2023/08/3-Raz%C3%B5es-para-Adotar-o-Estilo-Streetwear-em-Suas-Roupas-scaled.jpg"
                                                alt=""></a>
                                        <p class="drop-name">########</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </li>

                    <li title="Sobre N√≥s" class="nav__item dropdown item2">
                        <div class="header__link">
                            <a href="sobre-nos.html" class="nav__link">Sobre</a>
                        </div>
                    </li>
                </ul>

                <div class="nav__close" id="nav-close">
                    <i class="ri-close-fill"></i>
                </div>
            </div>

            <div class="mobile__icons">
                <div class="nav__burger">
                    <i id="burger" class="material-icons nav__toggle" onclick="clickMenu()">menu</i>
                </div>
                <div class="nav__search">
                    <a href="javascript:void(0)" id="open-search-btn-mobile">
                        <i class="ri-search-line"></i>
                    </a>
                </div>
            </div>

            <div class="logo-text-container">
                <h1><a class="logo-text" href="inicial.html">TopStyle <span>| Produto</span></a></h1>
            </div>

            <div class="social-header header-divs">
                <ul>
                    <li class="social__link" title="Pesquisa">
                        <a href="javascript:void(0)" id="open-search-btn" class="desktop">
                            <i class="ri-search-line"></i>
                        </a>
                    </li>

                    <li class="social__link" title="Seu Perfil"><a href="perfil-cliente.html"><i
                                class="ri-user-line"></i></a></li>
                    <li class="social__link" title="Carrinho">
                        <a href="carrinho.html" class="cart-icon">
                            <i class="ri-shopping-cart-line"></i>
                            <span id="cart-count" class="cart-count">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <div class="progress-bar"></div>

        <div id="search-modal" class="search-modal">
            <div class="search-overlay"></div>
            <div class="search-content">
                <div class="search-input-wrapper">
                    <i class="ri-search-line search-icon-input"></i>
                    <input type="text" id="search-input"
                        placeholder="O que voc√™ procura? (ex: Camiseta, Streetwear...)">
                    <i class="ri-close-line" id="close-search-btn"></i>
                </div>

                <div id="search-results" class="search-results">
                </div>
            </div>
        </div>

    </header>
  <div class="progress-bar"></div>


  <main>
    <div class="model-cloth">
      <section class="model-cloth-img swiper mySwiper">
        <div class="swiper-wrapper">
          <div class="swiper-slide">
            <img src="" alt="">
          </div>
          <div class="swiper-slide">
            <img src="" alt="">
          </div>
          <div class="swiper-slide">
            <img src="" alt="">
          </div>
          <div class="swiper-slide">
            <img src="" alt="">
          </div>
          <div class="swiper-slide">
            <img src="" alt="">
          </div>
        </div>

        <div class="swiper-pagination"></div>
        <div class="swiper-button-next"></div>
        <div class="swiper-button-prev"></div>
      </section>

      <section class="model-cloth-info">
        <div class="container">
          <div class="product" data-name="Camiseta Oversized Preta" data-price="149.90"
            data-img="img/camiseta-preta.png">
            <img src="img/Modelo-01.webp" alt="Camiseta Oversized Preta" class="hidden-cart-img">
            <h2>Camiseta Streetwear Prison Streetwear Club</h2>
            <div class="price">R$ 139,90 <small>ou 2x de R$ 69,5</small></div>

            <hr>

            <div class="options">
              <h4>Tamanho</h4>
              <div class="sizes model-sizes">
                <div data-size="PP" class="model-size-btn">PP</div>
                <div data-size="P" class="model-size-btn">P</div>
                <div data-size="M" class="model-size-btn">M</div>
                <div data-size="G" class="model-size-btn">G</div>
                <div data-size="GG" class="model-size-btn">GG</div>
              </div>
            </div>

            <div class="options">
              <h4>Cor</h4>
              <div class="colors">
                <div data-color="Preto"><span style="background: #000"></span> Preto</div>
              </div>
            </div>

            <div class="model-qty-add">
              <div class="model-qty-controls">
                <button type="button">‚àí</button>
                <input type="number" value="1" min="1" />
                <button type="button">+</button>
              </div>
              <button class="add-to-cart">Adicionar ao carrinho</button>
            </div>

            <div class="model-accordion">
              <div class="model-accordion-item">
                <div class="model-accordion-header">Detalhes <span>+</span></div>
                <div class="model-accordion-content"></div>
              </div>
              <div class="model-accordion-item">
              </div>
              <div class="model-accordion-item">
                <div class="model-accordion-header">Informa√ß√µes Complementares <span>+</span></div>
                <div class="model-accordion-content"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <section class="reviews-block">

      <div class="reviews-summary-block">
        <h3>Avalia√ß√µes do produto</h3>
        <div class="summary-content">
          <div class="summary-total">
            <span id="summary-total-reviews">(0 avalia√ß√µes)</span>

            <span id="summary-avg-rating">0.0</span>
            <div id="summary-stars-total"></div>

          </div>
          <div class="summary-bars">
            <div class="summary-bar-row">
              ‚òÖ <span>5</span> <progress id="summary-bar-5" value="0" max="100"></progress> <span
                id="summary-count-5">(0)</span>
            </div>
            <div class="summary-bar-row">
              ‚òÖ <span>4</span> <progress id="summary-bar-4" value="0" max="100"></progress> <span
                id="summary-count-4">(0)</span>
            </div>
            <div class="summary-bar-row">
              ‚òÖ <span>3</span> <progress id="summary-bar-3" value="0" max="100"></progress> <span
                id="summary-count-3">(0)</span>
            </div>
            <div class="summary-bar-row">
              ‚òÖ <span>2</span> <progress id="summary-bar-2" value="0" max="100"></progress> <span
                id="summary-count-2">(0)</span>
            </div>
            <div class="summary-bar-row">
              ‚òÖ <span>1</span> <progress id="summary-bar-1" value="0" max="100"></progress> <span
                id="summary-count-1">(0)</span>
            </div>
          </div>
        </div>
      </div>

      <section class="review-form-section">
        <h2>Enviar uma Avalia√ß√£o</h2>

        <form id="reviewForm">

          <div class="review-stars">
            <label>Avalia√ß√£o*</label>
            <div class="stars" id="starContainer">
              <span data-value="1">‚òÖ</span>
              <span data-value="2">‚òÖ</span>
              <span data-value="3">‚òÖ</span>
              <span data-value="4">‚òÖ</span>
              <span data-value="5">‚òÖ</span>
            </div>
            <input type="hidden" id="notaReview" name="nota" value="0">
          </div>

          <div class="form-group">
            <label for="tituloReview">T√≠tulo*</label>
            <input type="text" id="tituloReview" name="titulo" maxlength="100" placeholder="Resuma sua avalia√ß√£o..."
              required>
          </div>

          <div class="form-group">
            <label for="comment">Coment√°rio*</label>
            <textarea id="comment" name="comentario" maxlength="500" placeholder="Escreva sua opini√£o..."
              required></textarea>
          </div>

          <div class="form-group2">
            <label for="review-files" class="upload-box">
              <i class="bi bi-upload"></i>
            </label>
            <input type="file" id="review-files" multiple accept="image/*,video/*">
            <label for="" class="review-modific-span"> <span>Fotos/V√≠deos (opcional)</span>Fotos √† vontade (5MB cada) e
              1 v√≠deo (25MB).</label>
            <div class="review-media-preview" id="review-preview"></div>
          </div>


          <button type="submit" id="btnEnviarReview" class="button-reviews">Enviar</button>

          <button type="reset" class="button-reviews button-reviews-cancel">Cancelar</button>

        </form>
      </section>
      <section class="reviews-section">
        <h3>Avalia√ß√µes</h3>
        <div id="reviewsList">
        </div>

        <div class="reviews-pagination" id="reviewsPagination">
        </div>
      </section>
    </section>

    <section class="related-products-section" aria-label="Produtos relacionados">
      <h2 class="related-section-title">RECOMENDA√á√ïES PARA VOC√ä</h2>
      <div class="product-content">
        <div class="product-row">
          <div class="product-slot" data-slot="1"></div>
          <div class="product-slot" data-slot="2"></div>
          <div class="product-slot" data-slot="3"></div>
          <div class="product-slot" data-slot="4"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">

    <div class="footer-main">
      <div class="footer-brand">
        <h2>TopStyle</h2>
        <p>Mais que moda, √© movimento.
          Drops exclusivos, feitos para quem cria tend√™ncia.</p>
      </div>

      <div class="footer-links">
        <div>
          <h4>Cole√ß√µes</h4>
          <ul>
            <li><a href="#promotions-day">Novidades</a></li>
          </ul>
        </div>
        <div>
          <h4>Marca</h4>
          <ul>
            <li><a href="sobre-nos.html">Sobre n√≥s</a></li>
            <li><a href="https://www.instagram.com/moda.topstyle?igsh=MTU2NWg4ZDA2emQ0dQ==" target="_blank">Na m√≠dia</a></li>
          </ul>
        </div>
        <div>
          <h4>Ajuda</h4>
          <ul>
            <li><a href="medidas.html">Guia de tamanhos</a></li>
            <li><a href="suporte.html">Suporte</a></li>
            <li><a href="devolucao.html">Pol√≠tica de devolu√ß√£o</a></li>
            <li><a href="faq.html">FAQ</a></li>
          </ul>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <p>¬© 2025 TopStyle. Todos os direitos reservados.</p>
      <div class="footer-legal">
        <a href="termos.html">Termos / Privacidade / Cookies</a>
      </div>
    </div>
  </footer>

  <script src="assets/js/admiconedash.js"></script>
  <script src="assets/js/main.js"></script>
  <script src="assets/js/header-cell.js"></script>
  <script src="assets/js/drops.js"></script>
  <script type="module" src="assets/js/produto-novo.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="assets/js/error-logger.js"></script>
  <script src="assets/js/menu-hamburger.js"></script>
  <script src="assets/js/header-control.js"></script>
  <script src="assets/js/collection-linker.js"></script>
  <script src="assets/js/search-modal.js" type="module"></script>

  <script>
    // --- Accordion ---
    document.querySelectorAll('.model-accordion-header').forEach(header => {
      header.addEventListener('click', () => {
        const content = header.nextElementSibling;
        const isOpen = content.classList.contains('open');

        // Fecha todos os conte√∫dos
        document.querySelectorAll('.model-accordion-content').forEach(c => {
          c.classList.remove('open');
          c.previousElementSibling.querySelector('span').textContent = "+";
        });

        // Se o que clicou n√£o estava aberto, abre ele
        if (!isOpen) {
          content.classList.add('open');
          header.querySelector('span').textContent = "‚àí";
        }
      });
    });

    // ========================================================
    // SCRIPT DE RECOMENDA√á√ïES (Igual ao Carrinho.js)
    // ========================================================
    document.addEventListener('DOMContentLoaded', async () => {
      // 1. Fun√ß√£o auxiliar de formata√ß√£o
      function formatPriceBR(num) {
        if (typeof num !== 'number') num = 0;
        return `R$ ${num.toFixed(2).replace('.', ',')}`;
      }

      // 2. Fun√ß√£o de Renderiza√ß√£o (Estilo Card Padr√£o)
      function renderRecommendedProduct(container, product) {
        const mainImg = (product.cores && product.cores.length > 0 && product.cores[0].img1)
          ? product.cores[0].img1
          : (product.img || 'assets/img/sem-foto.png');

        // Estrutura compat√≠vel com main.js para Hover
        container.innerHTML = `
                <div class="product" data-id="${product.id}">
                    <a class="product-link" href="Blusa-modelo02.html?id=${product.id}">
                        <img src="${mainImg}" alt="${product.nome}">
                    </a>
                    <div class="product-text">
                        <p class="product-title">${product.nome}</p>
                        <p class="product-price">${formatPriceBR(Number(product.preco || product.price))}</p>
                        
                        <div class="product-options" style="display:none;">
                            <div class="colors"></div>
                            <div class="sizes"></div>
                        </div>
                    </div>
                </div>
            `;

        // Vincula os dados ao elemento para o main.js ler
        const productDiv = container.querySelector('.product');
        productDiv.__productMeta = product;
      }

      // 3. Fun√ß√£o Principal de Load
      async function loadRelatedProducts() {
        const slots = document.querySelectorAll('.related-products-section .product-slot');
        if (slots.length === 0) return;

        try {
          // Inicializa Supabase
          const supabase = await window.initSupabaseClient();
          const { data: { user } } = await supabase.auth.getUser();

          // Pega o ID do produto atual para N√ÉO recomendar ele mesmo
          const urlParams = new URLSearchParams(window.location.search);
          const currentProductId = urlParams.get('id');

          let products = [];

          if (user) {
            // Tenta RPC Personalizada (get_user_recommendations)
            const { data, error } = await supabase.rpc('get_user_recommendations', {
              target_user_id: user.id
            });

            if (!error && data && data.length > 0) {
              products = data;
            }
          }

          // Fallback: Se n√£o retornou nada (ou deslogado), pega produtos aleat√≥rios
          if (products.length === 0) {
            const { data: fallbackData } = await supabase
              .from('products')
              .select('*')
              .limit(12); // Pega um lote maior para ter variedade

            if (fallbackData) {
              // Embaralha
              products = fallbackData.sort(() => 0.5 - Math.random());
            }
          }

          // Filtragem: Remove o produto atual da lista
          if (currentProductId) {
            products = products.filter(p => p.id != currentProductId);
          }

          // Preenche os Slots (limita ao n√∫mero de slots dispon√≠veis, geralmente 4)
          slots.forEach((slot, index) => {
            if (products[index]) {
              renderRecommendedProduct(slot, products[index]);
            } else {
              slot.innerHTML = ''; // Limpa se n√£o tiver produto suficiente
            }
          });

          // 4. ATIVA OS EFEITOS DE HOVER (CORES/TAMANHOS) DO MAIN.JS
          if (typeof window.prepareProductHoverAndOptions === 'function') {
            window.prepareProductHoverAndOptions();
          }

        } catch (err) {
          console.error("Erro ao carregar produtos relacionados:", err);
        }
      }

      // Executa
      loadRelatedProducts();
    });
  </script>
</body>

</html>






